<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yapper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #26212B;
        }
        .profile-selection-glow:hover {
            box-shadow: 0 0 15px #a78bfa; /* violet-400 */
        }
        .post-card {
            background-color: #1B171E;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
        }
        /* Custom scrollbar for better dark mode aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }
        #new-post-btn:hover {
            filter: brightness(0.9);
        }
    </style>
</head>
<body class="text-white antialiased">

    <!-- App Container -->
    <div id="app-container" class="max-w-md mx-auto h-screen flex flex-col">

        <!-- Login Screen -->
        <div id="login-screen" class="flex flex-col items-center justify-center h-full p-8 text-center">
            <h1 class="text-3xl font-bold mb-4">login</h1>
            <p class="text-gray-400 mb-12">tap character</p>
            <div id="character-selection-container" class="grid grid-cols-3 gap-4">
                <!-- Characters will be injected here by JS -->
            </div>
             <p id="auth-status" class="mt-8 text-sm text-gray-500">connecting...</p>
        </div>

        <!-- Main App Screen -->
        <div id="main-app-screen" class="hidden h-full w-full flex-col">
            <!-- Header -->
            <header class="flex items-center justify-between p-4 backdrop-blur-sm sticky top-0 z-10 border-b border-gray-700" style="background-color: rgba(38, 33, 43, 0.8);">
                <div class="flex items-center gap-3">
                    <img id="user-avatar-img" class="w-8 h-8 rounded-full object-cover">
                    <span id="user-name" class="font-semibold"></span>
                </div>
                <button id="logout-button" title="Log Out">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 hover:text-white"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                </button>
            </header>

            <!-- Feed -->
            <main id="feed-container" class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- Posts will be injected here -->
            </main>

            <!-- New Post Button -->
            <div class="p-4">
                 <button id="new-post-btn" class="w-full text-white font-bold py-4 px-4 rounded-full shadow-lg transition-all transform hover:scale-105" style="background-color: #7F3BC3;">
                    + new yap
                </button>
            </div>
        </div>

        <!-- New Post Modal -->
        <div id="new-post-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
             <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-sm m-4">
                <div class="p-4 border-b border-gray-700">
                    <h3 class="text-lg font-semibold">create new yap</h3>
                </div>
                <div class="p-4">
                    <div id="pasted-image-preview-container" class="mb-2 hidden">
                         <img id="pasted-image-preview" class="max-h-40 rounded-lg w-auto mx-auto" src="" />
                         <button id="remove-image-btn" class="w-full text-sm text-red-500 hover:underline mt-2">remove pic</button>
                    </div>
                    <textarea id="post-textarea" class="w-full h-32 bg-gray-700 border border-gray-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none" placeholder="what's happening? u can also paste a pic"></textarea>
                </div>
                <div class="p-4 flex justify-end gap-2 bg-gray-800 rounded-b-lg">
                    <button id="discard-post-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-md font-semibold">nah</button>
                    <button id="send-post-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-md font-semibold disabled:bg-purple-900 disabled:cursor-not-allowed" disabled>yap</button>
                </div>
            </div>
        </div>

        <!-- Password Modal -->
        <div id="password-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
            <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-sm m-4">
                <div class="p-4 border-b border-gray-700">
                    <h3 id="password-modal-title" class="text-lg font-semibold">enter pass</h3>
                </div>
                <div class="p-4">
                    <input id="password-input" type="password" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Password...">
                    <p id="password-error" class="text-red-500 text-sm mt-2 hidden">wrong pass</p>
                </div>
                <div class="p-4 flex justify-end gap-2 bg-gray-800 rounded-b-lg">
                    <button id="cancel-login-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-md font-semibold">nah</button>
                    <button id="submit-login-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-md font-semibold">go</button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirm-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
            <div class="bg-gray-800 rounded-lg shadow-2xl w-full max-w-sm m-4">
                <div class="p-4">
                    <h3 id="confirm-modal-title" class="text-lg font-semibold">are u sure?</h3>
                    <p id="confirm-modal-text" class="text-gray-400 mt-2">this cannot be undone</p>
                </div>
                <div class="p-4 flex justify-end gap-2 bg-gray-900 rounded-b-lg">
                    <button id="confirm-cancel-btn" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-md font-semibold">cancel</button>
                    <button id="confirm-action-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md font-semibold">delete</button>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, addDoc, serverTimestamp, updateDoc, arrayUnion, arrayRemove, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyCjO0Z-aMLpH1b4sQ_bT3A_8m9DDeKlk7E",
            authDomain: "alina-a53ab.firebaseapp.com",
            projectId: "alina-a53ab",
            storageBucket: "alina-a53ab.appspot.com",
            messagingSenderId: "543963335916",
            appId: "1:543963335916:web:60a500d3aa43baaca5e9c9",
            measurementId: "G-DBSHERXPJ3"
        };
        
        // --- Character & User Config ---
        // IMPORTANT: Change these passwords!
        const characters = {
            'rishu': { name: 'rishu', password: 'a', isAdmin: false, image: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%2310B981'/%3E%3Ctext x='50' y='55' font-family='Arial' font-size='20' fill='white' text-anchor='middle'%3Erishu%3C/text%3E%3C/svg%3E` },
            'tugemut': { name: 'tugemut', password: 'a', isAdmin: false, image: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23D97706'/%3E%3Ctext x='50' y='55' font-family='Arial' font-size='16' fill='white' text-anchor='middle'%3Etugemut%3C/text%3E%3C/svg%3E` },
            'lyly': { name: 'lyly', password: 'a', isAdmin: false, image: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%239333EA'/%3E%3Ctext x='50' y='55' font-family='Arial' font-size='24' fill='white' text-anchor='middle'%3Elyly%3C/text%3E%3C/svg%3E` },
            'tavima': { name: 'tavima', password: 'a', isAdmin: false, image: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%233B82F6'/%3E%3Ctext x='50' y='55' font-family='Arial' font-size='24' fill='white' text-anchor='middle'%3Erishu%3C/text%3E%3C/svg%3E` },
            'keldonus': { name: 'keldonus', password: 'admin', isAdmin: true, image: `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%234b5563'/%3E%3Ctext x='50' y='55' font-family='Arial' font-size='24' fill='white' text-anchor='middle'%3Ekel%3C/text%3E%3C/svg%3E` },
        };

        const appId = firebaseConfig.projectId || 'dnd-feed-app-public';
        
        // --- App State ---
        let app, auth, db, storage;
        let currentUser = null;
        let pastedImageData = null;
        let selectedCharacterId = null;
        let postToDeleteId = null;

        // --- UI Elements ---
        const loginScreen = document.getElementById('login-screen');
        const mainAppScreen = document.getElementById('main-app-screen');
        const authStatus = document.getElementById('auth-status');
        const feedContainer = document.getElementById('feed-container');
        const userAvatarImg = document.getElementById('user-avatar-img');
        const userName = document.getElementById('user-name');
        
        const newPostBtn = document.getElementById('new-post-btn');
        const newPostModal = document.getElementById('new-post-modal');
        const postTextarea = document.getElementById('post-textarea');
        const discardPostBtn = document.getElementById('discard-post-btn');
        const sendPostBtn = document.getElementById('send-post-btn');
        const logoutButton = document.getElementById('logout-button');
        
        const pastedImagePreviewContainer = document.getElementById('pasted-image-preview-container');
        const pastedImagePreview = document.getElementById('pasted-image-preview');
        const removeImageBtn = document.getElementById('remove-image-btn');
        
        const characterSelectionContainer = document.getElementById('character-selection-container');
        const passwordModal = document.getElementById('password-modal');
        const passwordModalTitle = document.getElementById('password-modal-title');
        const passwordInput = document.getElementById('password-input');
        const passwordError = document.getElementById('password-error');
        const cancelLoginBtn = document.getElementById('cancel-login-btn');
        const submitLoginBtn = document.getElementById('submit-login-btn');

        const confirmModal = document.getElementById('confirm-modal');
        const confirmModalText = document.getElementById('confirm-modal-text');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        const confirmActionBtn = document.getElementById('confirm-action-btn');


        // --- Helper Functions ---
        const timeAgo = (timestamp) => {
            if (!timestamp) return 'just now';
            const now = new Date();
            const seconds = Math.floor((now - timestamp.toDate()) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hours ago";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " min ago";
            return Math.floor(seconds) < 5 ? 'just now' : Math.floor(seconds) + ' sec ago';
        };

        const renderPosts = (posts) => {
            feedContainer.innerHTML = '';
            if (posts.length === 0) {
                 feedContainer.innerHTML = `<div class="text-center text-gray-500 mt-10">
                    <p class="text-lg">feed is empty</p>
                    <p>be the first to post</p>
                </div>`;
                return;
            }
            posts.forEach(post => {
                const character = Object.values(characters).find(c => c.name === post.authorName);
                const postElement = document.createElement('div');
                postElement.className = 'p-4 rounded-lg post-card';
                postElement.dataset.id = post.id;

                const likes = post.likes || [];
                const likeCount = likes.length;
                const isLiked = currentUser && likes.includes(currentUser.userId);

                const deleteButtonHTML = currentUser && currentUser.isAdmin ? `
                    <button class="delete-post-btn text-gray-500 hover:text-red-500" data-id="${post.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    </button>` : '';

                postElement.innerHTML = `
                    <div class="flex items-start">
                        <img src="${character?.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'gray\'/%3E%3C/svg%3E'}" class="w-10 h-10 rounded-full mr-3 shrink-0 object-cover">
                        <div class="flex-1">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="font-bold text-gray-300">${post.authorName}</p>
                                    <p class="text-xs text-gray-400">${timeAgo(post.timestamp)}</p>
                                </div>
                                <div class="flex items-center gap-4">
                                    ${deleteButtonHTML}
                                    <div class="like-button flex items-center gap-2 text-gray-400 cursor-pointer transition-colors hover:text-white">
                                        <span class="like-count font-medium">${likeCount}</span>
                                        <svg class="like-heart" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="${isLiked ? '#FF70A2' : 'none'}" stroke="${isLiked ? '#FF70A2' : 'currentColor'}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                    </div>
                                </div>
                            </div>
                            <p class="text-gray-300 whitespace-pre-wrap mt-2">${post.text || ''}</p>
                            ${post.imageUrl ? `<img src="${post.imageUrl}" class="mt-3 rounded-lg w-full h-auto object-cover"/>` : ''}
                        </div>
                    </div>
                `;
                feedContainer.appendChild(postElement);
            });
        };
        
        const showView = (view) => {
            loginScreen.classList.add('hidden');
            mainAppScreen.classList.add('hidden');
            document.getElementById(view).classList.remove('hidden');
            if(view === 'main-app-screen') {
                 document.getElementById(view).classList.add('flex');
            }
        };

        const setupUIForUser = (userProfile) => {
            currentUser = userProfile;
            userName.textContent = userProfile.name;
            userAvatarImg.src = userProfile.image;
            showView('main-app-screen');
        };

        const handleLogin = async () => {
             if (!auth.currentUser) {
                console.error("login failed: user not authenticated.");
                passwordError.textContent = "auth failed. pls refresh.";
                passwordError.classList.remove('hidden');
                return;
             }
             const enteredPassword = passwordInput.value;
             const character = characters[selectedCharacterId];

             if (enteredPassword === character.password) {
                const userProfile = { 
                    name: character.name, 
                    characterId: selectedCharacterId, 
                    isAdmin: character.isAdmin,
                    image: character.image,
                    userId: auth.currentUser.uid 
                };
                const userDocRef = doc(db, `artifacts/${appId}/users`, auth.currentUser.uid);
                await setDoc(userDocRef, userProfile);
                setupUIForUser(userProfile);
                passwordModal.classList.add('hidden');
             } else {
                passwordError.textContent = "wrong password.";
                passwordError.classList.remove('hidden');
             }
        }

        // --- Event Listeners ---
        characterSelectionContainer.addEventListener('click', (e) => {
            const characterDiv = e.target.closest('.character-choice');
            if (characterDiv) {
                selectedCharacterId = characterDiv.dataset.id;
                passwordModalTitle.textContent = `Login as ${characters[selectedCharacterId].name}`;
                passwordInput.value = '';
                passwordError.classList.add('hidden');
                passwordModal.classList.remove('hidden');
                passwordInput.focus();
            }
        });

        cancelLoginBtn.addEventListener('click', () => passwordModal.classList.add('hidden'));
        submitLoginBtn.addEventListener('click', handleLogin);
        passwordInput.addEventListener('keydown', (e) => {
            if (e.key === 'enter') handleLogin();
        });


        logoutButton.addEventListener('click', async () => {
            const userDocRef = doc(db, `artifacts/${appId}/users`, auth.currentUser.uid);
            await setDoc(userDocRef, {deleted: true}); 
            currentUser = null;
            showView('login-screen');
        });

        feedContainer.addEventListener('click', async (e) => {
            const likeButton = e.target.closest('.like-button');
            const deleteButton = e.target.closest('.delete-post-btn');

            if (likeButton && currentUser) {
                const postElement = e.target.closest('.post-card');
                const postId = postElement.dataset.id;
                if (!postId) return;

                const postDocRef = doc(db, `artifacts/${appId}/public/data/posts`, postId);
                const postDoc = await getDoc(postDocRef);
                if (!postDoc.exists()) return;

                const postData = postDoc.data();
                const likes = postData.likes || [];
                
                if (likes.includes(currentUser.userId)) {
                    await updateDoc(postDocRef, { likes: arrayRemove(currentUser.userId) });
                } else {
                    await updateDoc(postDocRef, { likes: arrayUnion(currentUser.userId) });
                }
            }

            if (deleteButton && currentUser && currentUser.isAdmin) {
                const postId = deleteButton.dataset.id;
                if (postId) {
                    postToDeleteId = postId;
                    confirmModalText.textContent = "this post will be deleted.";
                    confirmModal.classList.remove('hidden');
                }
            }
        });
        
        confirmCancelBtn.addEventListener('click', () => {
            postToDeleteId = null;
            confirmModal.classList.add('hidden');
        });

        confirmActionBtn.addEventListener('click', async () => {
            if (postToDeleteId) {
                const postDocRef = doc(db, `artifacts/${appId}/public/data/posts`, postToDeleteId);
                await deleteDoc(postDocRef);
                postToDeleteId = null;
                confirmModal.classList.add('hidden');
            }
        });

        newPostBtn.addEventListener('click', () => newPostModal.classList.remove('hidden'));
        discardPostBtn.addEventListener('click', () => {
            newPostModal.classList.add('hidden');
            postTextarea.value = '';
            pastedImageData = null;
            pastedImagePreviewContainer.classList.add('hidden');
        });

        sendPostBtn.addEventListener('click', async () => {
            const text = postTextarea.value.trim();
            if (!text && !pastedImageData) return;

            sendPostBtn.disabled = true;
            sendPostBtn.textContent = 'yapping...';

            let imageUrl = null;
            try {
                if (pastedImageData) {
                    const storageRef = ref(storage, `artifacts/${appId}/public/images/${Date.now()}-${Math.random().toString(36).substring(2)}`);
                    const uploadResult = await uploadString(storageRef, pastedImageData, 'data_url');
                    imageUrl = await getDownloadURL(uploadResult.ref);
                }

                const newPost = {
                    authorName: currentUser.name,
                    authorId: auth.currentUser.uid,
                    text: text,
                    imageUrl: imageUrl, 
                    timestamp: serverTimestamp(),
                    likes: [] 
                };

                await addDoc(collection(db, `artifacts/${appId}/public/data/posts`), newPost);

            } catch(error) {
                console.error("Error creating post: ", error);
            } finally {
                newPostModal.classList.add('hidden');
                postTextarea.value = '';
                pastedImageData = null;
                pastedImagePreviewContainer.classList.add('hidden');
                pastedImagePreview.src = '';
                sendPostBtn.textContent = 'post';
            }
        });

        postTextarea.addEventListener('input', () => {
            sendPostBtn.disabled = postTextarea.value.trim().length === 0 && !pastedImageData;
        });

        postTextarea.addEventListener('paste', (event) => {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (const item of items) {
                if (item.type.indexOf('image') === 0) {
                    const blob = item.getAsFile();
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        pastedImageData = e.target.result; 
                        pastedImagePreview.src = pastedImageData;
                        pastedImagePreviewContainer.classList.remove('hidden');
                        sendPostBtn.disabled = false;
                    };
                    reader.readAsDataURL(blob);
                }
            }
        });

        removeImageBtn.addEventListener('click', () => {
            pastedImageData = null;
            pastedImagePreview.src = '';
            pastedImagePreviewContainer.classList.add('hidden');
            sendPostBtn.disabled = postTextarea.value.trim().length === 0;
        });

        // --- Initialization ---
        const initialize = () => {
             // Populate character selection
            characterSelectionContainer.innerHTML = Object.entries(characters).map(([id, char]) => `
                <div data-id="${id}" class="character-choice cursor-pointer flex flex-col items-center gap-2 p-2 rounded-lg transition-all transform hover:scale-110 profile-selection-glow">
                    <img src="${char.image}" class="w-24 h-24 rounded-full object-cover border-2 border-gray-600">
                    <p class="font-semibold">${char.name}</p>
                </div>
            `).join('');


            // Check if firebaseConfig is filled
            if (!firebaseConfig.apiKey) {
                authStatus.textContent = 'Firebase config is missing.';
                if(window.self === window.top) { // Avoid alert in iframes
                    alert("Error: Firebase configuration is missing from the code. Please follow the setup instructions.");
                }
                return;
            }

            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            storage = getStorage(app); 

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    authStatus.textContent = 'checking character...';
                    const userDocRef = doc(db, `artifacts/${appId}/users`, user.uid);
                    const userDoc = await getDoc(userDocRef);

                    if (userDoc.exists() && !userDoc.data().deleted) {
                        setupUIForUser(userDoc.data());
                    } else {
                        authStatus.textContent = 'Ready!';
                        showView('login-screen');
                    }
                    
                    const postsCollection = collection(db, `artifacts/${appId}/public/data/posts`);
                    onSnapshot(postsCollection, (querySnapshot) => {
                        const posts = [];
                        querySnapshot.forEach((doc) => {
                            posts.push({ id: doc.id, ...doc.data() });
                        });
                        posts.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));
                        renderPosts(posts);
                    });

                } else {
                    authStatus.textContent = 'auth failed. pls refresh.';
                }
            });

            (async () => {
                try {
                    authStatus.textContent = 'auth...';
                    await signInAnonymously(auth);
                } catch (error) {
                    console.error("auth Error: ", error);
                    let errorMessage = 'could not connect. pls refresh.';
                    if (error.code === 'auth/admin-restricted-operation') {
                        errorMessage = 'connection error: anon sign-in not enabled for this project. Please enable it in your Firebase Console under Authentication -> Sign-in method.';
                    }
                    authStatus.textContent = errorMessage;
                }
            })();
        };

        initialize();
    </script>
</body>
</html>

